<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
</head>
<body>

<textarea id="output" rows="20" cols="80"></textarea>
<button id="btn_host">Host</button>
<button id="btn_join">Join</button>
<br />
<input type="text" id="buf" style="width:40em"><button id="btn_send">Send</button>
<script type="text/javascript">
function echo(){output.append([].join.call(arguments, ',\t')+'\n')};
// (async function(){})();
btn_host.onclick = async function(){
  var pc = new RTCPeerConnection({certificates: [
    await RTCPeerConnection.generateCertificate({name: "ECDSA", namedCurve: "P-256"})
  ]})
  pc.onicecandidate = pc.onconnectionstatechange = pc.oniceconnectionstatechange = echo;
  // https://webrtchacks.com/the-minimum-viable-sdp/
  var dc = pc.createDataChannel('est-rtc');
  dc.onopen = dc.onmessage = echo;
  let offer = await pc.createOffer(); echo(offer.sdp);
  pc.setLocalDescription(offer);
  this.innerText = 'âœ…'; this.onclick=null
  btn_send.onclick = () => {dc.send(buf.value)}
}
btn_join.onclick = async function(){
  var pc = new RTCPeerConnection({certificates: [
    await RTCPeerConnection.generateCertificate({name: "ECDSA", namedCurve: "P-256"})
  ]})
  pc.ondatachannel = (event) => {event.channel.onopen = event.channel.onmessage = echo};
  await pc.setRemoteDescription({"type":"offer","sdp":output.value.replace(/[\r\n]/, '\r\n')});
  pc.setLocalDescription(await pc.createAnswer())
}
</script>
</body>
</html>